INSTALLATION_DIR=$1
BINARY_VERSION=<%= binary_version %>
DEST_DIR=`pwd`/nginx-${BINARY_VERSION}
FILENAME=nginx-${BINARY_VERSION}.tar.gz
TAR_URL=http://nginx.org/download/$FILENAME
PUBLIC_KEY=A1C052F8

template_steps() {
  ./configure \
    --prefix="/" \
    --error-log-path=stderr \
    --with-http_ssl_module \
    --with-http_realip_module \
    --with-http_gunzip_module \
    --with-http_gzip_static_module \
    --with-http_auth_request_module \
    --with-http_random_index_module \
    --with-http_secure_link_module \
    --with-http_stub_status_module \
    --without-http_uwsgi_module \
    --without-http_scgi_module \
    --with-pcre \
    --with-pcre-jit
  make -j 3 install DESTDIR=$INSTALLATION_DIR/nginx

  cd $INSTALLATION_DIR
  rm -rf nginx/html/ nginx/conf/*
}

# import public key for nginx
gpg --keyserver pgpkeys.mit.edu --recv-key $PUBLIC_KEY

main "$@"
