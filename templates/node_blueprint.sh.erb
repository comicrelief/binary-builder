#!/usr/bin/env bash
set -e

INSTALLATION_DIR=$1
BINARY_VERSION=v<%= binary_version %>
NODE_DIR=$INSTALLATION_DIR/node-${BINARY_VERSION}-linux-x64

curl <%= binary_uri %> -s --fail -o node-tarball
mkdir node-binary-directory
tar xzf node-tarball -C node-binary-directory
cd node-binary-directory

if [[ `lsb_release -r` == *10.04* ]]; then
  ./configure --shared-openssl-libpath=/lib/ --prefix=/
elif [[ `lsb_release -r` == *14.04* ]]; then
  ./configure --shared-openssl --prefix=/
fi

make -j 3 install DESTDIR=$NODE_DIR PORTABLE=1
cp LICENSE $NODE_DIR
